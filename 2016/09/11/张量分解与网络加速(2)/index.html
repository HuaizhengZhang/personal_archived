<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Make world different">
    <meta name="keyword"  content="Reading Coding Running">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#60090">
    <link rel="shortcut icon" href="/img/coffee.png">
    <link rel="alternate" type="application/atom+xml" title="Huaizheng" href="/atom.xml">

    <title>
        
          张量分解与网络加速(2)｜Huaizheng&#39;s Blog
        
    </title>

    <link rel="canonical" href="http://www.zhanghuaizheng.com/2016/09/11/张量分解与网络加速(2)/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>

<style>

    header.intro-header{
        background-image: url('http://7vznmi.com1.z0.glb.clouddn.com/banner.jpg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
                <span class="brand-logo">
                    Huaizheng
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    
                        
                        <li>
                            <a href="/reading/">Reading</a>
                        </li>
                        
                    
                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!--only post-->

    
        <img class="wechat-title-img" src="http://7vznmi.com1.z0.glb.clouddn.com/banner.jpg">
    

<style>

    header.intro-header{
        background-image: url('http://7vznmi.com1.z0.glb.clouddn.com/banner.jpg')
    }

</style>

<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>张量分解与网络加速(2)</h1>
                    
                    <span class="meta">
                         author: Zhang Huaizheng
                         <span>
                          time: 2016-09-11
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#tensor" title="tensor">tensor</a>
                        
                        <a class="tag" href="/tags/#CNN" title="CNN">CNN</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            张量分解与网络加速(2)
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
                <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">

                <p>[1] Novikov, Alexander, et al. “Tensorizing neural networks.” Advances in Neural Information Processing Systems. 2015.</p>
<p>[2] Lebedev, Vadim, et al. “Speeding-up convolutional neural networks using fine-tuned cp-decomposition.” arXiv preprint arXiv:1412.6553 (2014).<a id="more"></a></p>
<p>[3] Jaderberg, Max, Andrea Vedaldi, and Andrew Zisserman. “Speeding up convolutional neural networks with low rank expansions.” arXiv preprint arXiv:1405.3866 (2014).</p>
<p>[4] Fu, Jie, et al. “Deep Q-Networks for Accelerating the Training of Deep Neural Networks.” arXiv preprint arXiv:1606.01467 (2016).</p>
<p>[5] Shi, Yang, et al. “Tensor Contractions with Extended BLAS Kernels on CPU and GPU.” arXiv preprint arXiv:1606.05696 (2016).</p>
<p>[6] Jaderberg, Max, Karen Simonyan, and Andrew Zisserman. “Spatial transformer networks.” Advances in Neural Information Processing Systems. 2015.</p>
<p>[7] Koushik, Jayanth. “Understanding Convolutional Neural Networks.” arXiv preprint arXiv:1605.09081 (2016).</p>
<p>[8] <a href="http://tech.youmi.net/2016/07/163347168.html" target="_blank" rel="external">http://tech.youmi.net/2016/07/163347168.html</a> 卷积神经网络的数学推导</p>
<p>本周主要阅读上述文章，部分已经在前一次周记提过，本周在结合新的文章又重新阅读，做了些总结。</p>
<p>目前的阅读是以“加速CNN+张量运算”为核心进行探究，与文献[2]使用CP分解对神经网络加速相关的文章这两年有110多篇。总结目前的文章来看，是对测试时间加速居多，训练时间加速由于较难，所以只有少部分针对训练时间进行工作。主要是“分解”与“优化”两种方式来进行加速，不同的文章分别针对参数（parameter），过滤器（filter），卷积后的特征矩阵（feature map），学习率（learning rate），最小批处理大小（mini-batch）五个方面进行工作，多数加速损失了精度，但一般控制在1%左右，少部分加速竟然可以提高精度。</p>
<p>文献[2]提出对filter的低秩近似和feature map的低秩近似，并提出两种规则进行逼近，一种是最接近原始filter，第二种是接近原始feature map，文献[3]则是利用原始判别信息进行调整逼近。文献[3]实际构建了一个4D的张量，除了filter的width和height，还加入了输入的channel和输出的channel构成4阶张量，将其转换成4个较小卷积层插入到原始CNN。我们的方式更接近于文献[2]的规则2，将输出的特征矩阵（featrue map）进行分解，但主要问题在于，随着层数的增加，特征矩阵数量在每个卷积层过后都会显著增加，对每一个特征矩阵进行CP分解，再将得到的秩一张量相乘，输入到空间转换层，确实去掉了部分冗余信息，但是整体网络全局的计算量会大幅度提高，背离了我们加速的初衷。</p>
<p>文献[6]spatial transform network，相比最初的CNN ，训练时间增加了6%，精度提高了，而空间转换层实际是对卷积层输出的特征进行剪切、旋转等操作，减少了噪音信息，和张量分解的目的应该一致，如果整个网络层变成【卷积】-【CP分解】-【空间变换】，是否存在丢失的信息过多的情况。</p>
<p>上述提及CP分解的文献中，都有提到对于网络中数据进行重构会导致梯度爆炸的问题。根据文献[7,8]，又手工推了一下整体CNN的数学推导，网络正向顺序是卷积后进行下采样操作，进入之后的池化层，由于CNN的局部链接特性，所以BP求解时，要找到与该卷积层相关的池化层进行求解，而且由于卷基层到池化层使用了下采样操作，所以BP求解时要进行上采样操作，而对于数据的重构例如CP分解，在上采样操作时是否会导致和原feature map差距过大的情况，这或许就是导致容易出现梯度爆炸的原因。</p>
<p>文献[1]张量神经网络，和文献[6]空间转换网络的设计思路一致，都是在最初的CNN结构之上插入独立设计的新网络层。张量神经网络采用的是称作tensor train分解方式，主要针对CNN最后输出层之前的全连接层进行优化，使用tensor train分解后得到的核心矩阵减少全连接层参数，然后以TT-format的存储格式存储，极大地减少了全连接层本身所需要的参数，使网络整体的所需存储的参数下降了7倍，训练速度文中未提及，但是测试速度显著增加，仍旧可以使用BP进行进行求解。当将tensor train层插入到非卷积神经网络中时，对于某些数据集，实现了非卷积神经网络最高的精度。</p>
<p>文献[4]则提供了另一种思路，使用DQN网络对深度神经网络进行加速。DQN是一种增强学习，文章采用了Google发表在Nature上的一种增强学习方式，将奖励函数设置为对CNN进行加速，记录学习率（learning rate）和最小批处理（mini-batch）的当前状态，下一刻的状态若能对CNN进行加速则奖励，不断反馈，最终文献[4]不但加速了CNN训练速度，而且还获得了更高的精度。6月8号提交的论文，思路感觉非常的新颖。</p>
<p>文献[5]是作者团队与NVDIA合作，改进了张量收缩(Tensor Contractions)这种算法，无论是在CPU还是GPU上的运行，都做了大幅度的加速，当将该算法应用到Tuker分解时，最高达到了100倍的加速，不过还未看Tensor Contractions的原理，对于文献[5]理解还很不到位。目前看了这几篇文章，就发现了对于张量的4种算法：tensor train，tensor contractions，cp，tucker，感觉还是有特别多工作可以做。</p>
<p>在撰写工作周记的过程中，又发现了两篇300多引用的加速文章[9,10]，这个周将进行仔细阅读，对于CNN+加速，想进行系统研究，想把caffe、tensorflow等目前最火的框架进行熟悉学习，再多看一些相关文章</p>
<p>[9] Denton, Emily L., et al. “Exploiting linear structure within convolutional networks for efficient evaluation.” Advances in Neural Information Processing Systems. 2014.</p>
<p>[10] Ioffe, Sergey, and Christian Szegedy. “Batch normalization: Accelerating deep network training by reducing internal covariate shift.” arXiv preprint arXiv:1502.03167 (2015).</p>


                <hr>

                
                <!-- 多说 Share start -->
                <div class="ds-share"
                    style="text-align: right"
                    data-thread-key="2016/09/11/张量分解与网络加速(2)/"
                    data-title="张量分解与网络加速(2)"
                    data-url="http://www.zhanghuaizheng.com/2016/09/11/张量分解与网络加速(2)/"
                    data-images=""
                    data-content="[1] Novikov, Alexander, et al. “Tensorizing neu... | Huaizheng&#39;s Blog " >
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">
                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
                        <li><a class="ds-wechat flat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li><a class="ds-weibo flat" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-douban flat" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- 多说 Share end-->
                

                <ul class="pager">
                    
                    
                        <li class="next">
                            <a href="/2016/08/25/一些要做的事情/" data-toggle="tooltip" data-placement="top" title="一些要做的事情">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                
                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread"
                        data-thread-key="2016/09/11/张量分解与网络加速(2)/"
                        data-title="张量分解与网络加速(2)"
                        data-url="http://www.zhanghuaizheng.com/2016/09/11/张量分解与网络加速(2)/" >
                    </div>
                </div>
                <!-- 多说评论框 end -->
                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col" >
                <div class="toc-wrap">
                    
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                <h5 class="text-center">
                    <a href="/tags/">FEATURED TAGS</a>
                </h5>
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#tensor" title="tensor">tensor</a>
                        
                          <a class="tag" href="/tags/#CNN" title="CNN">CNN</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>

    </div>
</article>


<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    // dynamic User by Hux
    var _user = 'zhz';

    // duoshuo comment query.
    var duoshuoQuery = {short_name: _user };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->






    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <span class="text-muted"style="font-size: 14px">双击导航条返回顶部</span>
                <br>
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/zhzHNN">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/zhanghuaizheng">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/zhzhnn">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/zhanghuaizheng">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://github.com/HuaizhengZhang">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://www.linkedin.com/in/huaizheng">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Huaizheng 2016
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                    <br>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://www.zhanghuaizheng.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->



<!-- Baidu Tongji -->

<script>
    var _baId = '37b701031d64255bdae74dad83ccaddb';
    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','null','2.0.0');
</script>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <!--wechat title img-->
    <img class="wechat-title-img" src="http://7vznmi.com1.z0.glb.clouddn.com/P50619-195123.jpg">
</body>

</html>
